import cv2
import json

# JSON 데이터
json_data = {
  "dataID": 76657511,
  "data_set_info": {
    "sourceValue": "IMAGE/A/BLUE/[00028]A_BLUE/[BLUE]00028A_130409_009.jpg",
    "data": [
      {
        "objectID": "data_set_info_76657511_1",
        "value": {
          "metainfo": {
            "violation_type": "BLUE",
            "video_id": "00028",
            "camera_channel": "A",
            "time_info": "130409",
            "camera_number": "009"
          },
          "annotation": "POLYGONS",
          "points": [
            {
              "x": 694.5246802813515,
              "y": 824.5886318809705
            },
            {
              "x": 728.2728240044181,
              "y": 828.5898884308713
            },
            {
              "x": 747.6644547904622,
              "y": 830.4083590710076
            },
            {
              "x": 700.2970323368789,
              "y": 886.9964746218808
            },
            {
              "x": 637.8366740186913,
              "y": 950.1888731938391
            },
            {
              "x": 520.4999462027865,
              "y": 1080
            },
            {
              "x": 403.3135643876152,
              "y": 1080
            },
            {
              "x": 638.0089041120764,
              "y": 873.8233606262504
            }
          ],
          "object_Label": {
            "lane_type": "lane_blue",
            "lane_attribute": "double_solid"
          },
          "extra": {
            "value": "lane",
            "label": "차선",
            "color": "#e0182d"
          }
        }
      },
      {
        "objectID": "data_set_info_76657511_2",
        "value": {
          "metainfo": {
            "violation_type": "BLUE",
            "video_id": "00028",
            "camera_channel": "A",
            "time_info": "130409",
            "camera_number": "009"
          },
          "annotation": "POLYGONS",
          "points": [
            {
              "x": 538.0637117357523,
              "y": 801.585769911426
            },
            {
              "x": 556.7181599865509,
              "y": 803.7699564012397
            },
            {
              "x": 557.7104178722317,
              "y": 810.123953462516
            },
            {
              "x": 563.8624167634524,
              "y": 812.5067023604947
            },
            {
              "x": 578.3493818943916,
              "y": 812.7052647686596
            },
            {
              "x": 579.5400913572086,
              "y": 810.322515870681
            },
            {
              "x": 625.38240567566,
              "y": 816.8750753401222
            },
            {
              "x": 654.3563359375385,
              "y": 819.059261829936
            },
            {
              "x": 728.2728240044181,
              "y": 828.5898884308713
            },
            {
              "x": 795.0953956574511,
              "y": 834.1889925742084
            },
            {
              "x": 857.6386893228516,
              "y": 838.8000195157801
            },
            {
              "x": 867.8431214472064,
              "y": 841.7642511210762
            },
            {
              "x": 883.9727077082835,
              "y": 842.7523283228415
            },
            {
              "x": 922.8153848267954,
              "y": 848.0220733989236
            },
            {
              "x": 936.3115692493291,
              "y": 829.2486065653816
            },
            {
              "x": 940.9200224667798,
              "y": 831.8834791034226
            },
            {
              "x": 954.7453821191314,
              "y": 831.5541200361674
            },
            {
              "x": 963.3039380943967,
              "y": 823.9788614892997
            },
            {
              "x": 968.2415665416652,
              "y": 809.4870625300744
            },
            {
              "x": 971.862494069662,
              "y": 785.1144915531953
            },
            {
              "x": 973.5083702187515,
              "y": 763.3767931143573
            },
            {
              "x": 979.7626995852916,
              "y": 756.7896117692549
            },
            {
              "x": 1002.1466152129085,
              "y": 714.3022920933441
            },
            {
              "x": 1001.1590895234549,
              "y": 707.0563926137315
            },
            {
              "x": 1006.4258932005412,
              "y": 703.4334428739252
            },
            {
              "x": 1011.0343464179916,
              "y": 690.2590801837202
            },
            {
              "x": 1013.0093977968991,
              "y": 676.7553584262603
            },
            {
              "x": 1013.0093977968991,
              "y": 639.5377838264316
            },
            {
              "x": 1014.9844491758065,
              "y": 552.9163491383346
            },
            {
              "x": 1017.6178510143496,
              "y": 552.9163491383346
            },
            {
              "x": 1018.2762014739853,
              "y": 567.0787890303048
            },
            {
              "x": 1019.922077623075,
              "y": 573.9953294426624
            },
            {
              "x": 1025.5180565299793,
              "y": 581.8999470567853
            },
            {
              "x": 1030.4556849772475,
              "y": 583.5467423930609
            },
            {
              "x": 1034.4057877350624,
              "y": 581.241228922275
            },
            {
              "x": 1034.4057877350624,
              "y": 572.6778931736419
            },
            {
              "x": 1033.0344946628388,
              "y": 561.9292811300292
            },
            {
              "x": 1032.2066213047879,
              "y": 548.5102426621189
            },
            {
              "x": 1034.8558160505502,
              "y": 542.8775598484282
            },
            {
              "x": 1034.69024137894,
              "y": 536.5822084684208
            },
            {
              "x": 1034.3590920357199,
              "y": 532.1091956457841
            },
            {
              "x": 1029.2262772158056,
              "y": 528.9615199557804
            },
            {
              "x": 1022.9344396946204,
              "y": 525.8138442657768
            },
            {
              "x": 1011.5097873535211,
              "y": 520.3468285936652
            },
            {
              "x": 1008.6950179361488,
              "y": 510.9038015236543
            },
            {
              "x": 1007.5359952348779,
              "y": 498.47876590521884
            },
            {
              "x": 1006.542547205217,
              "y": 488.87007169362874
            },
            {
              "x": 1004.3900764742851,
              "y": 483.40305602151716
            },
            {
              "x": 999.5884109975912,
              "y": 477.93604034940563
            },
            {
              "x": 993.1309988047959,
              "y": 470.64668611992346
            },
            {
              "x": 992.4687001183554,
              "y": 465.6766718725493
            },
            {
              "x": 985.6801385823399,
              "y": 460.8723247667543
            },
            {
              "x": 974.917784927681,
              "y": 456.2336448025384
            },
            {
              "x": 961.8373858704804,
              "y": 440.49526635252016
            },
            {
              "x": 948.4258374700594,
              "y": 423.76288505302705
            },
            {
              "x": 932.1995196522661,
              "y": 405.7051666209009
            },
            {
              "x": 925.907682131081,
              "y": 396.59347383404827
            },
            {
              "x": 917.4633738789641,
              "y": 388.14444961351217
            },
            {
              "x": 910.5092376713384,
              "y": 382.84310108297973
            },
            {
              "x": 888.8189556904108,
              "y": 376.3820825613933
            },
            {
              "x": 855.5384466967736,
              "y": 371.24640117243996
            },
            {
              "x": 804.8725971840722,
              "y": 366.7733883498032
            },
            {
              "x": 757.6838157751838,
              "y": 363.7913798013787
            },
            {
              "x": 720.4295146629033,
              "y": 363.62571265979955
            },
            {
              "x": 683.6719375654533,
              "y": 365.11671693401183
            },
            {
              "x": 651.7160259446972,
              "y": 367.43605691611975
            },
            {
              "x": 615.951896876908,
              "y": 371.90906973875656
            },
            {
              "x": 592.6058681798789,
              "y": 375.88508113665586
            },
            {
              "x": 580.6844918239492,
              "y": 378.7014225435012
            },
            {
              "x": 573.233631601493,
              "y": 383.0087682245588
            },
            {
              "x": 568.7631154680195,
              "y": 390.298122454041
            },
            {
              "x": 566.9417940803078,
              "y": 399.4098152408936
            },
            {
              "x": 564.00680541821,
              "y": 440.6333146298088
            },
            {
              "x": 558.0639373773413,
              "y": 478.0447412191751
            },
            {
              "x": 550.1401133228496,
              "y": 481.7611080989134
            },
            {
              "x": 544.4448647836838,
              "y": 488.2028106904599
            },
            {
              "x": 543.9496257802781,
              "y": 505.05034054527385
            },
            {
              "x": 543.9496257802781,
              "y": 541.4707359667099
            },
            {
              "x": 542.9591477734666,
              "y": 571.9449443805645
            },
            {
              "x": 539.9877137530322,
              "y": 590.774536571239
            },
            {
              "x": 539.4924747496265,
              "y": 619.0189248572506
            },
            {
              "x": 540.235333254735,
              "y": 640.8216105517156
            },
            {
              "x": 538.501996742815,
              "y": 697.5581449157213
            },
            {
              "x": 537.0162797325978,
              "y": 726.0502909937155
            },
            {
              "x": 537.7591382377065,
              "y": 752.5603747358492
            },
            {
              "x": 535.2829432206778,
              "y": 756.5244994075701
            },
            {
              "x": 536.0258017257863,
              "y": 778.8227006860003
            }
          ],
          "object_Label": {
            "vehicle_type": "vehicle_bus",
            "vehicle_attribute": "violation",
            "vehicle_shown": "shown"
          },
          "extra": {
            "value": "vehicle",
            "label": "차량",
            "color": "#096ecd"
          }
        }
      }
    ]
  }
}

# 이미지 경로
input_image_path = 'yolov5/dataset/train/images/_BLUE_00028A_130409_009.jpg'
output_image_path = 'output_image.jpg'

# Parse the JSON data
data = json_data
objects = data['data_set_info']['data']

# Extract lane objects with 'lane_blue' type
lane_blue_objects = [
    obj["value"]["points"] 
    for obj in objects 
    if "object_Label" in obj["value"] and "lane_type" in obj["value"]["object_Label"] and obj["value"]["object_Label"]["lane_type"] == "lane_blue"
]

# 이미지 로드
image = cv2.imread(input_image_path)

# 이미지 로드가 성공적으로 이루어졌는지 확인
if image is not None:
    # 파란색 차선이 있는지 확인
    if len(lane_blue_objects) > 0 and isinstance(lane_blue_objects[0], list) and len(lane_blue_objects[0]) > 0:
        # 파란색 차선이 존재하면 메시지 출력
        print("버스 전용 차선입니다.")

        # 파란색 차선을 이미지에 그림
        for points in lane_blue_objects:
            if isinstance(points, list) and len(points) > 0:
                for i in range(len(points) - 1):
                    if 'x' in points[i] and 'y' in points[i] and 'x' in points[i + 1] and 'y' in points[i + 1]:
                        cv2.line(image, (int(points[i]['x']), int(points[i]['y'])),
                                 (int(points[i + 1]['x']), int(points[i + 1]['y'])), (255, 0, 0), 2)

        # 그린 파란색 차선이 있는 이미지 저장
        cv2.imwrite(output_image_path, image)
    else:
        print("버스 전용 차선이 아닙니다.")
else:
    print("오류: 이미지를 로드하는 데 실패했습니다.")


